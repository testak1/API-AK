<!DOCTYPE html>
<html>
<head>
  <title>Model Image Upload Tool</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; }
    input, select { width: 100%; padding: 8px; box-sizing: border-box; }
    button { background: #4285f4; color: white; border: none; padding: 10px 15px; cursor: pointer; }
    button:disabled { background: #cccccc; }
    #preview { max-width: 200px; max-height: 200px; margin-top: 10px; }
    #status { margin-top: 15px; padding: 10px; border-radius: 4px; }
    .success { background: #e6ffed; color: #1a7321; }
    .error { background: #ffebee; color: #c62828; }
  </style>
</head>
<body>
  <h1>Model Image Upload Tool</h1>
  
  <div class="form-group">
    <label for="brand">Brand:</label>
    <input type="text" id="brand" placeholder="e.g. Audi">
  </div>
  
  <div class="form-group">
    <label for="modelName">Model Name:</label>
    <input type="text" id="modelName" placeholder="e.g. Q8">
  </div>
  
  <div class="form-group">
    <label for="modelId">Model ID:</label>
    <input type="text" id="modelId" placeholder="e.g. 881">
  </div>
  
  <div class="form-group">
    <label for="imageUpload">PNG Image:</label>
    <input type="file" id="imageUpload" accept=".png">
    <img id="preview" style="display: none;">
  </div>
  
  <button id="uploadBtn" disabled>Upload to Sanity</button>
  
  <div id="status"></div>
  
  <script>
    // Configuration - Update these with your Sanity details
    const SANITY_CONFIG = {
      projectId: 'wensahkh',
      dataset: 'production',
      token: 'skHgHx2tsGKHCTgZ3AZvJZQMKMKIwjUAVV2a6ju4KiPnKs0Q0rmOn6GsfpnP5ABFfXaQeFxNbp4gd7b4MLklTdVDfXPxnsmhfRhbTmmA1a2YsPE7ix8L4myLvJVfO82tUIim6G4zoQ0XmHKhGKnUyqPpYUIiWQqDcodTGUwk1XYty6GSvQEU',
      apiVersion: '2025-04-23'
    };

    // DOM elements
    const brandInput = document.getElementById('brand');
    const modelNameInput = document.getElementById('modelName');
    const modelIdInput = document.getElementById('modelId');
    const imageUpload = document.getElementById('imageUpload');
    const preview = document.getElementById('preview');
    const uploadBtn = document.getElementById('uploadBtn');
    const statusDiv = document.getElementById('status');

    // Preview uploaded image
    imageUpload.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file && file.type === 'image/png') {
        const reader = new FileReader();
        reader.onload = function(event) {
          preview.src = event.target.result;
          preview.style.display = 'block';
          uploadBtn.disabled = false;
        };
        reader.readAsDataURL(file);
      } else {
        showStatus('Please select a PNG image', 'error');
        uploadBtn.disabled = true;
      }
    });

    // Upload to Sanity
    uploadBtn.addEventListener('click', async function() {
      const brand = brandInput.value.trim();
      const modelName = modelNameInput.value.trim();
      const modelId = modelIdInput.value.trim();
      const file = imageUpload.files[0];

      if (!brand || !modelName || !modelId || !file) {
        showStatus('Please fill all fields', 'error');
        return;
      }

      try {
        showStatus('Uploading...');
        uploadBtn.disabled = true;

        // 1. Upload image to Sanity
        const imageUrl = await uploadImageToSanity(file, brand, modelName);
        
        // 2. Create new model entry
        const newModel = {
          name: modelName,
          id: modelId,
          image_url: imageUrl,
          brand: brand
        };

        // 3. Update JSON file (simulated here - in real use would save to file)
        showStatus(`Success! New model added:<br>
          Brand: ${brand}<br>
          Model: ${modelName}<br>
          ID: ${modelId}<br>
          Image URL: ${imageUrl}`, 'success');

        // For actual file saving, you would:
        // - Either send this to a backend endpoint
        // - Or use the File System Access API (see note below)
        console.log('New model to add:', newModel);

        // Reset form
        brandInput.value = '';
        modelNameInput.value = '';
        modelIdInput.value = '';
        imageUpload.value = '';
        preview.style.display = 'none';
        uploadBtn.disabled = true;

      } catch (error) {
        showStatus(`Error: ${error.message}`, 'error');
        uploadBtn.disabled = false;
      }
    });

    // Helper function to upload image to Sanity
    async function uploadImageToSanity(file, brand, modelName) {
      const formData = new FormData();
      formData.append('file', file, `${brand.toLowerCase()}-${modelName.toLowerCase()}.png`);

      const response = await fetch(
        `https://${SANITY_CONFIG.projectId}.api.sanity.io/v${SANITY_CONFIG.apiVersion}/assets/images/${SANITY_CONFIG.dataset}`,
        {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${SANITY_CONFIG.token}`
          },
          body: formData
        }
      );

      if (!response.ok) {
        throw new Error(`Sanity upload failed: ${response.status}`);
      }

      const result = await response.json();
      return `https://cdn.sanity.io/images/${SANITY_CONFIG.projectId}/${SANITY_CONFIG.dataset}/${result.document._id}.png`;
    }

    // Helper function to show status messages
    function showStatus(message, type = '') {
      statusDiv.textContent = '';
      statusDiv.innerHTML = message;
      statusDiv.className = type;
    }
  </script>

  <!-- Note about file saving -->
  <div style="margin-top: 30px; padding: 10px; background: #fff8e1; border-left: 4px solid #ffc107;">
    <h3>Important Note:</h3>
    <p>This tool runs in your browser. To actually save to your JSON file, you would need to:</p>
    <ol>
      <li>Set up a simple backend endpoint to handle file updates, or</li>
      <li>Use the <a href="https://web.dev/file-system-access/" target="_blank">File System Access API</a> (Chrome only)</li>
      <li>Alternatively, the tool outputs the new model data to console which you can manually add</li>
    </ol>
  </div>
</body>
</html>
